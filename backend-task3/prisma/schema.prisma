generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model Product {
  id    Int    @id @default(autoincrement())
  name  String @db.NVarChar(255)
  unit  String @default("cái") @db.NVarChar(50)
  price Int

  inv   Inventory?
  media MediaAsset[]
}

model Inventory {
  productId Int     @id
  stock     Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model MediaAsset {
  id        Int     @id @default(autoincrement())
  productId Int
  // SQL Server không hỗ trợ enum → lưu string ngắn
  type      String  @db.NVarChar(10) // 'image' | 'video'
  url       String  @db.NVarChar(1000)
  sizeBytes Int
  isPrimary Boolean @default(false)
  sortOrder Int     @default(0)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId, isPrimary, sortOrder])
}
